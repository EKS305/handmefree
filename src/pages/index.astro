---
export const prerender = false;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>HandMeFree – Upload Test</title>
  </head>

  <body>
    <h1>HandMeFree – Image moderation test</h1>

    <input type="file" accept="image/*" id="imageInput" />
    <p id="result"></p>

    <script>
      const input = document.getElementById("imageInput");
      const result = document.getElementById("result");

      input.addEventListener("change", async () => {
        const file = input.files[0];
        if (!file) return;

        result.textContent = "Checking image…";

        const form = new FormData();
        form.append("image", file);

        try {
          const res = await fetch(
            "https://handmefree-api.ehsankarimi27.workers.dev",
            {
              method: "POST",
              body: form,
            }
          );

          const data = await res.json();

          if (data.allowed) {
            result.textContent = "✅ Image allowed. You can continue.";
          } else {
            result.textContent = "❌ Blocked: " + data.reason;
            input.value = ""; // reset file input
          }
        } catch (err) {
          result.textContent = "⚠️ Error checking image.";
        }
      });
    </script>
  </body>
</html>
